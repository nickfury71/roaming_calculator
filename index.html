<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Калькулятор роуминга — Турция (Билайн)</title>
  <meta name="theme-color" content="#111827">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" href="icon-192.png">
  <style>
    :root{--bg:#ffffff;--fg:#111827;--muted:#6b7280;--border:#e5e7eb;--card:#ffffff;--shadow:0 1px 6px rgba(0,0,0,.06)}
    :root.dark{--bg:#0b0f14;--fg:#e5e7eb;--muted:#9aa4b2;--border:#273345;--card:#0f1520}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:12px}
    h1{margin:0;font-size:26px}
    .lead{color:var(--muted);margin:2px 0 10px}
    .explain{margin:0 0 16px}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.g2{grid-template-columns:1fr 1fr}.g3{grid-template-columns:repeat(3,1fr)}}
    .card{border:1px solid var(--border);border-radius:16px;padding:16px;background:var(--card);box-shadow:var(--shadow)}
    .title{font-size:18px;margin:0 0 10px}
    .subtitle{font-weight:600;margin:10px 0 8px}
    .row{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:10px;padding:8px 12px;margin-bottom:8px}
    .row input[type=number]{width:160px;padding:8px;text-align:right;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--fg)}
    input[type=checkbox]{transform:scale(1.1)}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--fg);cursor:pointer}
    .btn + .btn{margin-left:8px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    ul{margin:0 0 0 18px;padding:0}
    small{color:var(--muted)}
    .muted{color:var(--muted)}
    .right{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    @media print{
      .toolbar, .lead, .explain {display:none}
      body{background:#fff;color:#000}
      .card{box-shadow:none;border-color:#ccc}
    }
    .cost-inline{display:flex;align-items:center;gap:8px}
    .cost-inline input{width:110px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Калькулятор роуминга (Турция, Билайн)</h1>
        <p class="lead">Работает офлайн (PWA). Значения сохраняются на устройстве. Можно распечатать/сохранить в PDF.</p>
        <p class="explain">Инструмент помогает оценить расход мобильного трафика в поездке по Турции и понять, хватает ли выбранного пакета ГБ. 
        Можно учесть платные опции — безлимит для карт и мессенджеров — и сразу увидеть, как они влияют на итоговую стоимость.</p>
      </div>
      <div class="toolbar">
        <button class="btn" id="darkToggle">Тёмная тема</button>
        <button class="btn" id="resetBtn">Сброс</button>
        <button class="btn" onclick="window.print()">PDF/Печать</button>
      </div>
    </header>

    <div class="grid g2">
      <div class="card">
        <h2 class="title">Пакет и стоимость</h2>
        <div class="row"><span>Цена пакета, ₽</span><input id="priceRub" type="number" value="1400"></div>
        <div class="row"><span>Размер пакета, ГБ</span><input id="packageGB" type="number" value="1" step="0.5" min="0.5"></div>
        <div class="row"><span>Суток использования</span><input id="days" type="number" value="7" min="1"></div>
        <div class="row"><span>1 ГБ =</span><span><button id="btn1000" class="btn">1000 МБ</button><button id="btn1024" class="btn">1024 МБ</button></span></div>
        <div class="right">
          <label class="cost-inline"><input id="unlimMaps" type="checkbox"> Безлимитные карты
            <span class="muted">(+</span><input id="costMaps" type="number" value="900"><span class="muted">₽)</span>
          </label>
          <label class="cost-inline"><input id="unlimMessengers" type="checkbox"> Безлимитные мессенджеры
            <span class="muted">(+</span><input id="costMess" type="number" value="900"><span class="muted">₽)</span>
          </label>
        </div>
        <small>Если галочка включена — стоимость опции добавится к «Итого».</small>
      </div>

      <div class="card" style="background:var(--bg)">
        <h2 class="title">Итоги</h2>
        <ul>
          <li>Платный трафик в день: <b><span id="mbDayPaid">0</span></b> МБ</li>
          <li>За период: <b><span id="totalMB">0</span></b> МБ</li>
          <li>Объём пакета: <b><span id="packageMB">0</span></b> МБ</li>
          <li>«Использовано из пакета»: <b><span id="estCostRub">0</span></b> ₽ из <span id="priceRubEcho">0</span> ₽</li>
          <li>Доп. опции: <b><span id="addonsCost">0</span></b> ₽</li>
          <li>Итого ориентировочно: <b><span id="grandTotal">0</span></b> ₽</li>
          <li>Запас трафика: <b><span id="spareMB">0</span></b> МБ</li>
          <li>Цена 1 МБ: ~<b><span id="perMB">0</span></b> ₽/МБ</li>
        </ul>
        <small>Если «За период» намного меньше «Объёма пакета» — можно брать пакет поменьше.</small>
      </div>
    </div>

    <div class="card">
      <h2 class="title">Ежедневное использование</h2>
      <div class="grid g3">
        <div>
          <div class="subtitle">Карты</div>
          <div class="row"><span>Маршрутов/день</span><input id="mapsRoutesPerDay" type="number" value="2"></div>
          <div class="row"><span>Минут навигации/день</span><input id="mapsNavMinutesPerDay" type="number" value="60"></div>
          <small>≈ <span id="mbMaps">0</span> МБ/день (до безлимита)</small>
        </div>
        <div>
          <div class="subtitle">WhatsApp</div>
          <div class="row"><span>Текстов/день</span><input id="waTextsPerDay" type="number" value="20"></div>
          <div class="row"><span>Фото/день</span><input id="waPhotosPerDay" type="number" value="2"></div>
          <div class="row"><span>Звонков (мин)/день</span><input id="waCallsMinPerDay" type="number" value="0"></div>
        </div>
        <div>
          <div class="subtitle">Telegram</div>
          <div class="row"><span>Текстов/день</span><input id="tgTextsPerDay" type="number" value="20"></div>
          <div class="row"><span>Фото/день</span><input id="tgPhotosPerDay" type="number" value="2"></div>
          <div class="row"><span>Коротких видео (10с)/день</span><input id="tgShortVideosPerDay" type="number" value="0"></div>
        </div>
      </div>

      <div class="grid g3" style="margin-top:12px">
        <div>
          <div class="subtitle">Прочее</div>
          <div class="row"><span>Вызовов такси/день</span><input id="taxiRequestsPerDay" type="number" value="1"></div>
          <div class="row"><span>Проверок почты/день</span><input id="emailChecksPerDay" type="number" value="1"></div>
          <div class="row"><span>Веб‑страниц/день</span><input id="webPagesPerDay" type="number" value="2"></div>
          <small>Прочее ≈ <span id="mbMisc">0</span> МБ/день</small>
        </div>
        <div>
          <div class="subtitle">Вес действий (МБ)</div>
          <div class="row"><span>Маршрут (карты)</span><input id="w_mapsRoute" type="number" step="0.1" value="3"></div>
          <div class="row"><span>Навигация — минута</span><input id="w_mapsNavPerMin" type="number" step="0.1" value="0.5"></div>
          <div class="row"><span>WhatsApp — текст</span><input id="w_waText" type="number" step="0.01" value="0.02"></div>
          <div class="row"><span>WhatsApp — фото</span><input id="w_waPhoto" type="number" step="0.1" value="0.4"></div>
          <div class="row"><span>Звонок WhatsApp — минута</span><input id="w_waCallPerMin" type="number" step="0.1" value="0.8"></div>
          <div class="row"><span>Telegram — текст</span><input id="w_tgText" type="number" step="0.01" value="0.02"></div>
          <div class="row"><span>Telegram — фото</span><input id="w_tgPhoto" type="number" step="0.1" value="0.5"></div>
          <div class="row"><span>Короткое видео (10с)</span><input id="w_tgShortVideo10s" type="number" step="0.1" value="3.5"></div>
          <div class="row"><span>Вызов такси — 1 раз</span><input id="w_taxiRequest" type="number" step="0.1" value="1.5"></div>
          <div class="row"><span>Проверка почты — 1 раз</span><input id="w_emailCheck" type="number" step="0.1" value="1.5"></div>
          <div class="row"><span>Открытие веб‑страницы — 1 шт</span><input id="w_webPage" type="number" step="0.1" value="2"></div>
        </div>
        <div>
          <div class="subtitle">Пресеты</div>
          <button class="btn" id="presetEconom">Эконом (твой)</button>
          <button class="btn" id="presetMax">Максимум (безлимиты ON)</button>
          <p class="muted" style="margin-top:8px">Подстройка «под себя» в два клика.</p>
        </div>
      </div>
    </div>

    <footer class="wrap"><small>* Оценки трафика ориентировочные; зависят от приложений и качества сети.</small></footer>
  </div>

  <script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
    const $ = (id) => document.getElementById(id);
    const LS_KEY = 'roamingCalcStateV2';
    const state = { mbPerGB: 1000 };

    function readNum(id){ return Number($(id).value)||0; }
    function readBool(id){ return $(id).checked; }
    function fmt(n){ return (Math.round(n*10)/10).toLocaleString('ru-RU'); }
    function save(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(getAll())); }catch(e){} }
    function load(){
      try{
        const s = JSON.parse(localStorage.getItem(LS_KEY)||'{}');
        Object.entries(s).forEach(([k,v])=>{
          const el = document.getElementById(k);
          if(!el) return;
          if(el.type==='checkbox') el.checked = !!v;
          else el.value = v;
        });
        if(s.mbPerGB) state.mbPerGB = s.mbPerGB;
        if(s.theme==='dark') document.documentElement.classList.add('dark');
      }catch(e){}
    }
    function getAll(){
      const ids = ['priceRub','packageGB','days','unlimMaps','unlimMessengers','costMaps','costMess',
        'mapsRoutesPerDay','mapsNavMinutesPerDay','waTextsPerDay','waPhotosPerDay','waCallsMinPerDay',
        'tgTextsPerDay','tgPhotosPerDay','tgShortVideosPerDay','taxiRequestsPerDay','emailChecksPerDay','webPagesPerDay',
        'w_mapsRoute','w_mapsNavPerMin','w_waText','w_waPhoto','w_waCallPerMin','w_tgText','w_tgPhoto','w_tgShortVideo10s','w_taxiRequest','w_emailCheck','w_webPage'
      ];
      const obj = { mbPerGB: state.mbPerGB, theme: document.documentElement.classList.contains('dark')?'dark':'light' };
      ids.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        obj[id] = el.type==='checkbox' ? el.checked : el.value;
      });
      return obj;
    }

    function recalc(){
      const priceRub = readNum('priceRub'); const packageGB = readNum('packageGB'); const days = readNum('days');
      const unlimMaps = readBool('unlimMaps'); const unlimMess = readBool('unlimMessengers');
      const costMaps = readNum('costMaps'); const costMess = readNum('costMess');
      const mapsRoutesPerDay = readNum('mapsRoutesPerDay'); const mapsNavMinutesPerDay = readNum('mapsNavMinutesPerDay');
      const waTextsPerDay = readNum('waTextsPerDay'); const waPhotosPerDay = readNum('waPhotosPerDay'); const waCallsMinPerDay = readNum('waCallsMinPerDay');
      const tgTextsPerDay = readNum('tgTextsPerDay'); const tgPhotosPerDay = readNum('tgPhotosPerDay'); const tgShortVideosPerDay = readNum('tgShortVideosPerDay');
      const taxiRequestsPerDay = readNum('taxiRequestsPerDay'); const emailChecksPerDay = readNum('emailChecksPerDay'); const webPagesPerDay = readNum('webPagesPerDay');
      const w = { mapsRoute: readNum('w_mapsRoute'), mapsNavPerMin: readNum('w_mapsNavPerMin'), w_waText: readNum('w_waText'), w_waPhoto: readNum('w_waPhoto'),
                  w_waCallPerMin: readNum('w_waCallPerMin'), w_tgText: readNum('w_tgText'), w_tgPhoto: readNum('w_tgPhoto'),
                  w_tgShortVideo10s: readNum('w_tgShortVideo10s'), w_taxiRequest: readNum('w_taxiRequest'), w_emailCheck: readNum('w_emailCheck'), w_webPage: readNum('w_webPage') };

      const mbMaps = mapsRoutesPerDay*w.mapsRoute + mapsNavMinutesPerDay*w.mapsNavPerMin;
      const mbWA = waTextsPerDay*w.w_waText + waPhotosPerDay*w.w_waPhoto + waCallsMinPerDay*w.w_waCallPerMin;
      const mbTG = tgTextsPerDay*w.w_tgText + tgPhotosPerDay*w.w_tgPhoto + tgShortVideosPerDay*w.w_tgShortVideo10s;
      const mbMisc = taxiRequestsPerDay*w.w_taxiRequest + emailChecksPerDay*w.w_emailCheck + webPagesPerDay*w.w_webPage;

      const mbDayPaid = (unlimMaps?0:mbMaps) + (unlimMess?0:(mbWA+mbTG)) + mbMisc;
      const totalMB = mbDayPaid * days;
      const packageMB = packageGB * state.mbPerGB;
      const perMBPrice = priceRub / (packageMB || 1);
      const estCostRub = Math.min(totalMB, packageMB) * perMBPrice;
      const addons = (unlimMaps?costMaps:0) + (unlimMess?costMess:0);
      const grand = estCostRub + addons;
      const spareMB = Math.max(packageMB - totalMB, 0);

      document.getElementById('mbMaps').textContent = fmt(mbMaps);
      document.getElementById('mbMisc').textContent = fmt(mbMisc);
      document.getElementById('mbDayPaid').textContent = fmt(mbDayPaid);
      document.getElementById('totalMB').textContent = fmt(totalMB);
      document.getElementById('packageMB').textContent = fmt(packageMB);
      document.getElementById('perMB').textContent = (Math.round(perMBPrice*1000)/1000).toFixed(3);
      document.getElementById('estCostRub').textContent = fmt(estCostRub);
      document.getElementById('addonsCost').textContent = addons.toLocaleString('ru-RU');
      document.getElementById('grandTotal').textContent = grand.toLocaleString('ru-RU');
      document.getElementById('spareMB').textContent = fmt(spareMB);
      document.getElementById('priceRubEcho').textContent = priceRub.toLocaleString('ru-RU');
      save();
    }

    function bindAll(){
      document.querySelectorAll('input').forEach(el=>{ el.addEventListener('input', recalc); el.addEventListener('change', recalc); });
      document.getElementById('btn1000').addEventListener('click', ()=>{ state.mbPerGB=1000; recalc(); });
      document.getElementById('btn1024').addEventListener('click', ()=>{ state.mbPerGB=1024; recalc(); });
      document.getElementById('presetEconom').addEventListener('click', ()=>{
        document.getElementById('unlimMaps').checked = false; document.getElementById('unlimMessengers').checked = false;
        document.getElementById('mapsRoutesPerDay').value = 2; document.getElementById('mapsNavMinutesPerDay').value = 60;
        document.getElementById('waTextsPerDay').value = 20; document.getElementById('waPhotosPerDay').value = 2; document.getElementById('waCallsMinPerDay').value = 0;
        document.getElementById('tgTextsPerDay').value = 20; document.getElementById('tgPhotosPerDay').value = 2; document.getElementById('tgShortVideosPerDay').value = 0;
        document.getElementById('taxiRequestsPerDay').value = 1; document.getElementById('emailChecksPerDay').value = 1; document.getElementById('webPagesPerDay').value = 2;
        recalc();
      });
      document.getElementById('presetMax').addEventListener('click', ()=>{
        document.getElementById('unlimMaps').checked = true; document.getElementById('unlimMessengers').checked = true;
        document.getElementById('mapsRoutesPerDay').value = 4; document.getElementById('mapsNavMinutesPerDay').value = 90;
        document.getElementById('waTextsPerDay').value = 60; document.getElementById('waPhotosPerDay').value = 6; document.getElementById('waCallsMinPerDay').value = 5;
        document.getElementById('tgTextsPerDay').value = 60; document.getElementById('tgPhotosPerDay').value = 6; document.getElementById('tgShortVideosPerDay').value = 3;
        document.getElementById('taxiRequestsPerDay').value = 2; document.getElementById('emailChecksPerDay').value = 2; document.getElementById('webPagesPerDay').value = 6;
        recalc();
      });
      document.getElementById('darkToggle').addEventListener('click', ()=>{
        document.documentElement.classList.toggle('dark'); save();
      });
      document.getElementById('resetBtn').addEventListener('click', ()=>{
        localStorage.removeItem(LS_KEY); location.reload();
      });
    }

    load(); bindAll(); recalc();
  </script>
</body>
</html>
